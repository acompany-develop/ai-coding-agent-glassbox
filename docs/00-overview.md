# 00. 全体像

AI コーディングエージェント（Claude Code, Cursor など）の内部構造を理解するための最小実装です。

## このプロジェクトで学べること

1. **エージェントループ** - Think → Act → Observe のサイクル
2. **Tool Use（Function Calling）** - LLM がツールを呼び出す仕組み
3. **マルチプロバイダー対応** - 異なる LLM API を統一インターフェースで扱う方法
4. **stop_reason による制御** - エージェントループの終了条件

## アーキテクチャ図

```
┌─────────────────────────────────────────────────────────────┐
│                        main.py                               │
│                    (エントリーポイント)                       │
│                                                             │
│  1. LLMクライアント初期化                                    │
│  2. ツールレジストリ初期化                                    │
│  3. エージェント初期化                                       │
│  4. 対話ループ開始                                          │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                      Agent (agent.py)                        │
│                                                             │
│  ┌──────────┐     ┌──────────┐     ┌──────────┐            │
│  │  THINK   │ ──▶ │   ACT    │ ──▶ │ OBSERVE  │ ─┐         │
│  │ LLM呼出  │     │ ツール実行│     │ 結果収集  │  │         │
│  └──────────┘     └──────────┘     └──────────┘  │         │
│       ▲                                           │         │
│       └───────────────────────────────────────────┘         │
│                                                             │
│  stop_reason == "end_turn" になるまでループ                  │
└─────────────────────────────────────────────────────────────┘
        │                       │
        ▼                       ▼
┌──────────────────┐  ┌─────────────────────────────────────┐
│  LLM Clients     │  │          Tool Registry              │
│  (llm_clients/)  │  │                                     │
│                  │  │  ツール定義を管理し、                │
│  API差異を吸収    │  │  名前でツールを実行                  │
│                  │  │                                     │
│  ┌────────────┐  │  │  ┌─────────┐ ┌─────────┐          │
│  │  Gemini    │  │  │  │read_file│ │write_file│  ...     │
│  ├────────────┤  │  │  └─────────┘ └─────────┘          │
│  │  Llama     │  │  │                                     │
│  └────────────┘  │  └─────────────────────────────────────┘
└──────────────────┘
```

## ファイル構成

```
src/
├── main.py              # エントリーポイント（→ 01-agent-loop.md）
├── agent.py             # エージェントループ（→ 01-agent-loop.md）
├── tool_registry.py     # ツール管理（→ 04-tools.md）
├── message_history.py   # 会話履歴（→ 05-message-history.md）
├── colors.py            # CLI カラー出力
├── llm_clients/         # LLM クライアント（→ 03-llm-clients.md）
│   ├── base.py          # 抽象基底クラス
│   ├── gemini_client.py # Gemini 実装
│   └── llama_client.py  # Llama 実装
└── tools/               # ツール実装（→ 04-tools.md）
    ├── base.py          # ツール基底クラス
    ├── read_file.py
    ├── write_file.py
    ├── list_files.py
    └── execute_command.py
```

## ドキュメント一覧

| ファイル | 内容 |
|---------|------|
| [01-agent-loop.md](./01-agent-loop.md) | エージェントループの仕組み |
| [02-tool-use.md](./02-tool-use.md) | Tool Use（Function Calling）の詳細 |
| [03-llm-clients.md](./03-llm-clients.md) | LLM クライアントの抽象化 |
| [04-tools.md](./04-tools.md) | ツールの実装方法 |
| [05-message-history.md](./05-message-history.md) | メッセージ履歴の管理 |
| [06-stop-reason.md](./06-stop-reason.md) | stop_reason による状態遷移 |

## 読む順序

1. まず **01-agent-loop.md** でエージェントの基本動作を理解
2. 次に **02-tool-use.md** で LLM とツールの連携を理解
3. **06-stop-reason.md** でループ制御の仕組みを理解
4. 残りは興味に応じて読む
