# A3. 既存の AI Coding Agent の実装

主要な AI Coding Agent の実装方式を調査・比較します。

## 概要

| ツール | 開発元 | エージェントパターン | Tool Use 方式 | 特徴 |
|--------|--------|---------------------|---------------|------|
| Claude Code | Anthropic | ReAct | Native | CLI ベース、公式ツール |
| Cursor | Anysphere | ReAct | Native | VSCode ベース IDE |
| GitHub Copilot | GitHub/OpenAI | ReAct | Native | エディタ統合 |
| Aider | Paul Gauthier | ReAct | JSON/Native | Git 統合、OSS |
| Cline | Saoud Rizwan | ReAct | Native | VSCode 拡張、OSS |
| Devin | Cognition | Plan-and-Execute | 独自 | 自律型、Web UI |

---

## 1. Claude Code

Anthropic 公式の AI コーディング CLI ツール。

### アーキテクチャ

```
┌─────────────────────────────────────────────────────────────┐
│                      Claude Code                             │
│                                                             │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐     │
│  │   CLI       │───▶│   Agent     │───▶│   Claude    │     │
│  │   Interface │    │   Loop      │    │   API       │     │
│  └─────────────┘    └─────────────┘    └─────────────┘     │
│                            │                                │
│                            ▼                                │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                    Tools                            │   │
│  │  Read, Write, Edit, Bash, Glob, Grep, ...          │   │
│  └─────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

### 特徴

- **Native Tool Use**: Anthropic API の Tool Use を使用
- **豊富なツール**: 20+ のビルトインツール
- **MCP 対応**: Model Context Protocol でツール拡張可能
- **安全機能**: 危険なコマンドの確認プロンプト

### ツール一覧（一部）

| ツール | 説明 |
|--------|------|
| Read | ファイル読み込み |
| Write | ファイル書き込み |
| Edit | 差分編集 |
| Bash | シェルコマンド実行 |
| Glob | ファイルパターン検索 |
| Grep | 内容検索 |
| WebFetch | URL 取得 |
| Task | サブエージェント起動 |

---

## 2. Cursor

VSCode ベースの AI コードエディタ。

### アーキテクチャ

```
┌─────────────────────────────────────────────────────────────┐
│                        Cursor                                │
│                                                             │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐     │
│  │   VSCode    │───▶│   Agent     │───▶│ OpenAI /    │     │
│  │   Extension │    │   Core      │    │ Claude API  │     │
│  └─────────────┘    └─────────────┘    └─────────────┘     │
│         │                  │                                │
│         ▼                  ▼                                │
│  ┌─────────────┐    ┌─────────────────────────────────┐    │
│  │  Editor     │    │           Tools                 │    │
│  │  Integration│    │  codebase_search, read_file,   │    │
│  └─────────────┘    │  edit_file, run_terminal, ...  │    │
│                     └─────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────┘
```

### 特徴

- **IDE 統合**: エディタと深く統合
- **コンテキスト認識**: 開いているファイル、カーソル位置を認識
- **Tab 補完**: Copilot 的な補完機能
- **Agent モード**: 複雑なタスクを自律実行

### Agent モードのツール

| ツール | 説明 |
|--------|------|
| codebase_search | コードベース全体を検索 |
| read_file | ファイル読み込み |
| edit_file | ファイル編集（差分適用） |
| run_terminal_command | ターミナルコマンド実行 |
| list_directory | ディレクトリ一覧 |

---

## 3. GitHub Copilot

GitHub / OpenAI によるコード補完 + エージェント機能。

### アーキテクチャ

```
┌─────────────────────────────────────────────────────────────┐
│                    GitHub Copilot                            │
│                                                             │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐     │
│  │   Editor    │───▶│   Copilot   │───▶│   OpenAI    │     │
│  │   Plugin    │    │   Service   │    │   API       │     │
│  └─────────────┘    └─────────────┘    └─────────────┘     │
│         │                  │                                │
│         ▼                  ▼                                │
│  ┌─────────────┐    ┌─────────────────────────────────┐    │
│  │  Inline     │    │         Copilot Chat            │    │
│  │  Completion │    │  @workspace, @terminal, ...     │    │
│  └─────────────┘    └─────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────┘
```

### 特徴

- **インライン補完**: リアルタイムコード提案
- **Copilot Chat**: 対話形式でコード生成
- **@メンション**: `@workspace`, `@terminal` でコンテキスト指定
- **GitHub 統合**: Issue, PR との連携

### Chat のスコープ

| スコープ | 説明 |
|---------|------|
| @workspace | ワークスペース全体をコンテキストに |
| @terminal | ターミナル出力を参照 |
| @vscode | VSCode の機能について質問 |
| #file | 特定ファイルを参照 |
| #selection | 選択範囲を参照 |

---

## 4. Aider

Git 対応のオープンソース AI コーディングツール。

### アーキテクチャ

```
┌─────────────────────────────────────────────────────────────┐
│                        Aider                                 │
│                                                             │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐     │
│  │   CLI       │───▶│   Chat      │───▶│ GPT-4 /     │     │
│  │   Interface │    │   Loop      │    │ Claude API  │     │
│  └─────────────┘    └─────────────┘    └─────────────┘     │
│                            │                                │
│                            ▼                                │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                    Git Integration                  │   │
│  │  自動コミット、差分表示、ブランチ管理               │   │
│  └─────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

### 特徴

- **Git ファースト**: 変更を自動コミット
- **差分ベース編集**: SEARCH/REPLACE 形式
- **マルチファイル対応**: 複数ファイルを同時編集
- **OSS**: MIT ライセンス

### 編集フォーマット

```
<<<<<<< SEARCH
def greet():
    return "Hello"
=======
def greet(name: str):
    return f"Hello, {name}"
>>>>>>> REPLACE
```

### リポジトリ

- GitHub: [paul-gauthier/aider](https://github.com/paul-gauthier/aider)

---

## 5. Cline (旧 Claude Dev)

VSCode 拡張の AI コーディングエージェント。

### アーキテクチャ

```
┌─────────────────────────────────────────────────────────────┐
│                        Cline                                 │
│                                                             │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐     │
│  │   VSCode    │───▶│   Agent     │───▶│ Claude /    │     │
│  │   Webview   │    │   Core      │    │ OpenAI API  │     │
│  └─────────────┘    └─────────────┘    └─────────────┘     │
│         │                  │                                │
│         ▼                  ▼                                │
│  ┌─────────────┐    ┌─────────────────────────────────┐    │
│  │  Approval   │    │           Tools                 │    │
│  │  UI         │    │  read, write, execute, browse  │    │
│  └─────────────┘    └─────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────┘
```

### 特徴

- **Human-in-the-loop**: 各操作に承認 UI
- **ブラウザ操作**: Puppeteer でブラウザ自動化
- **MCP 対応**: 外部ツールサーバー連携
- **OSS**: Apache 2.0 ライセンス

### 承認フロー

```
┌─────────────────────────────────────────┐
│  Cline wants to execute:                │
│                                         │
│  $ npm install express                  │
│                                         │
│  [Approve]  [Reject]  [Always Allow]   │
└─────────────────────────────────────────┘
```

### リポジトリ

- GitHub: [cline/cline](https://github.com/cline/cline)

---

## 6. Devin

Cognition による自律型 AI ソフトウェアエンジニア。

### アーキテクチャ

```
┌─────────────────────────────────────────────────────────────┐
│                        Devin                                 │
│                                                             │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐     │
│  │   Web UI    │───▶│   Planner   │───▶│   Executor  │     │
│  │             │    │             │    │             │     │
│  └─────────────┘    └─────────────┘    └─────────────┘     │
│                            │                  │             │
│                            ▼                  ▼             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │              Sandboxed Environment                  │   │
│  │  Shell, Browser, Editor (仮想デスクトップ)         │   │
│  └─────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

### 特徴

- **Plan-and-Execute**: 事前計画型
- **自律実行**: 長時間のタスクを自動実行
- **仮想環境**: サンドボックス内で完全な開発環境
- **ブラウザ操作**: ドキュメント参照、デバッグ

### 非公開

- 実装詳細は非公開
- API アクセスのみ提供

---

## 比較表

| 項目 | Claude Code | Cursor | Aider | Cline |
|------|-------------|--------|-------|-------|
| 形態 | CLI | IDE | CLI | VSCode 拡張 |
| OSS | No | No | Yes | Yes |
| LLM | Claude | 複数 | 複数 | 複数 |
| Git 統合 | 基本 | 基本 | 強力 | 基本 |
| 承認 UI | CLI 確認 | なし | なし | GUI |
| MCP 対応 | Yes | No | No | Yes |

---

## 本実装との比較

本実装は、これらのツールの核心部分を抽出した教育用実装です。

| 機能 | Claude Code | 本実装 |
|------|-------------|--------|
| エージェントループ | ReAct | ReAct |
| Tool Use | Native | Native + JSON |
| ツール数 | 20+ | 4 |
| MCP | 対応 | 非対応 |
| サブエージェント | 対応 | 非対応 |
| Human-in-the-loop | CLI 確認 | 非対応 |

本実装を理解すれば、これらのツールの内部動作も理解できます。
